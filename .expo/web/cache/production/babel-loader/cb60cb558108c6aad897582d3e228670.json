{"ast":null,"code":"'use strict';var _toConsumableArray=require(\"@babel/runtime/helpers/toConsumableArray\");var _classCallCheck=require(\"@babel/runtime/helpers/classCallCheck\");var _createClass=require(\"@babel/runtime/helpers/createClass\");var Systrace=require('../Performance/Systrace');var deepFreezeAndThrowOnMutationInDev=require('../Utilities/deepFreezeAndThrowOnMutationInDev');var stringifySafe=require('../Utilities/stringifySafe').default;var warnOnce=require('../Utilities/warnOnce');var ErrorUtils=require('../vendor/core/ErrorUtils');var invariant=require('invariant');var TO_JS=0;var TO_NATIVE=1;var MODULE_IDS=0;var METHOD_IDS=1;var PARAMS=2;var MIN_TIME_BETWEEN_FLUSHES_MS=5;var TRACE_TAG_REACT_APPS=1<<17;var DEBUG_INFO_LIMIT=32;var MessageQueue=function(){function MessageQueue(){_classCallCheck(this,MessageQueue);this._lazyCallableModules={};this._queue=[[],[],[],0];this._successCallbacks=new Map();this._failureCallbacks=new Map();this._callID=0;this._lastFlush=0;this._eventLoopStartTime=Date.now();this._reactNativeMicrotasksCallback=null;if(__DEV__){this._debugInfo={};this._remoteModuleTable={};this._remoteMethodTable={};}this.callFunctionReturnFlushedQueue=this.callFunctionReturnFlushedQueue.bind(this);this.flushedQueue=this.flushedQueue.bind(this);this.invokeCallbackAndReturnFlushedQueue=this.invokeCallbackAndReturnFlushedQueue.bind(this);}_createClass(MessageQueue,[{key:\"callFunctionReturnFlushedQueue\",value:function callFunctionReturnFlushedQueue(module,method,args){var _this=this;this.__guard(function(){_this.__callFunction(module,method,args);});return this.flushedQueue();}},{key:\"invokeCallbackAndReturnFlushedQueue\",value:function invokeCallbackAndReturnFlushedQueue(cbID,args){var _this2=this;this.__guard(function(){_this2.__invokeCallback(cbID,args);});return this.flushedQueue();}},{key:\"flushedQueue\",value:function flushedQueue(){var _this3=this;this.__guard(function(){_this3.__callReactNativeMicrotasks();});var queue=this._queue;this._queue=[[],[],[],this._callID];return queue[0].length?queue:null;}},{key:\"getEventLoopRunningTime\",value:function getEventLoopRunningTime(){return Date.now()-this._eventLoopStartTime;}},{key:\"registerCallableModule\",value:function registerCallableModule(name,module){this._lazyCallableModules[name]=function(){return module;};}},{key:\"registerLazyCallableModule\",value:function registerLazyCallableModule(name,factory){var module;var getValue=factory;this._lazyCallableModules[name]=function(){if(getValue){module=getValue();getValue=null;}return module;};}},{key:\"getCallableModule\",value:function getCallableModule(name){var getValue=this._lazyCallableModules[name];return getValue?getValue():null;}},{key:\"callNativeSyncHook\",value:function callNativeSyncHook(moduleID,methodID,params,onFail,onSucc){if(__DEV__){invariant(global.nativeCallSyncHook,'Calling synchronous methods on native '+'modules is not supported in Chrome.\\n\\n Consider providing alternative '+'methods to expose this method in debug mode, e.g. by exposing constants '+'ahead-of-time.');}this.processCallbacks(moduleID,methodID,params,onFail,onSucc);return global.nativeCallSyncHook(moduleID,methodID,params);}},{key:\"processCallbacks\",value:function processCallbacks(moduleID,methodID,params,onFail,onSucc){var _this4=this;if(onFail||onSucc){if(__DEV__){this._debugInfo[this._callID]=[moduleID,methodID];if(this._callID>DEBUG_INFO_LIMIT){delete this._debugInfo[this._callID-DEBUG_INFO_LIMIT];}if(this._successCallbacks.size>500){var info={};this._successCallbacks.forEach(function(_,callID){var debug=_this4._debugInfo[callID];var module=debug&&_this4._remoteModuleTable[debug[0]];var method=debug&&_this4._remoteMethodTable[debug[0]][debug[1]];info[callID]={module:module,method:method};});warnOnce('excessive-number-of-pending-callbacks',\"Please report: Excessive number of pending callbacks: \"+this._successCallbacks.size+\". Some pending callbacks that might have leaked by never being called from native code: \"+stringifySafe(info));}}onFail&&params.push(this._callID<<1);onSucc&&params.push(this._callID<<1|1);this._successCallbacks.set(this._callID,onSucc);this._failureCallbacks.set(this._callID,onFail);}if(__DEV__){global.nativeTraceBeginAsyncFlow&&global.nativeTraceBeginAsyncFlow(TRACE_TAG_REACT_APPS,'native',this._callID);}this._callID++;}},{key:\"enqueueNativeCall\",value:function enqueueNativeCall(moduleID,methodID,params,onFail,onSucc){this.processCallbacks(moduleID,methodID,params,onFail,onSucc);this._queue[MODULE_IDS].push(moduleID);this._queue[METHOD_IDS].push(methodID);if(__DEV__){var isValidArgument=function isValidArgument(val){switch(typeof val){case'undefined':case'boolean':case'string':return true;case'number':return isFinite(val);case'object':if(val==null){return true;}if(Array.isArray(val)){return val.every(isValidArgument);}for(var k in val){if(typeof val[k]!=='function'&&!isValidArgument(val[k])){return false;}}return true;case'function':return false;default:return false;}};var replacer=function replacer(key,val){var t=typeof val;if(t==='function'){return'<<Function '+val.name+'>>';}else if(t==='number'&&!isFinite(val)){return'<<'+val.toString()+'>>';}else{return val;}};invariant(isValidArgument(params),'%s is not usable as a native method argument',JSON.stringify(params,replacer));deepFreezeAndThrowOnMutationInDev(params);}this._queue[PARAMS].push(params);var now=Date.now();if(global.nativeFlushQueueImmediate&&now-this._lastFlush>=MIN_TIME_BETWEEN_FLUSHES_MS){var queue=this._queue;this._queue=[[],[],[],this._callID];this._lastFlush=now;global.nativeFlushQueueImmediate(queue);}Systrace.counterEvent('pending_js_to_native_queue',this._queue[0].length);if(__DEV__&&this.__spy&&isFinite(moduleID)){this.__spy({type:TO_NATIVE,module:this._remoteModuleTable[moduleID],method:this._remoteMethodTable[moduleID][methodID],args:params});}else if(this.__spy){this.__spy({type:TO_NATIVE,module:moduleID+'',method:methodID,args:params});}}},{key:\"createDebugLookup\",value:function createDebugLookup(moduleID,name,methods){if(__DEV__){this._remoteModuleTable[moduleID]=name;this._remoteMethodTable[moduleID]=methods||[];}}},{key:\"setReactNativeMicrotasksCallback\",value:function setReactNativeMicrotasksCallback(fn){this._reactNativeMicrotasksCallback=fn;}},{key:\"__guard\",value:function __guard(fn){if(this.__shouldPauseOnThrow()){fn();}else{try{fn();}catch(error){ErrorUtils.reportFatalError(error);}}}},{key:\"__shouldPauseOnThrow\",value:function __shouldPauseOnThrow(){return typeof DebuggerInternal!=='undefined'&&DebuggerInternal.shouldPauseOnThrow===true;}},{key:\"__callReactNativeMicrotasks\",value:function __callReactNativeMicrotasks(){Systrace.beginEvent('JSTimers.callReactNativeMicrotasks()');if(this._reactNativeMicrotasksCallback!=null){this._reactNativeMicrotasksCallback();}Systrace.endEvent();}},{key:\"__callFunction\",value:function __callFunction(module,method,args){this._lastFlush=Date.now();this._eventLoopStartTime=this._lastFlush;if(__DEV__||this.__spy){Systrace.beginEvent(module+\".\"+method+\"(\"+stringifySafe(args)+\")\");}else{Systrace.beginEvent(module+\".\"+method+\"(...)\");}if(this.__spy){this.__spy({type:TO_JS,module:module,method:method,args:args});}var moduleMethods=this.getCallableModule(module);if(!moduleMethods){var callableModuleNames=Object.keys(this._lazyCallableModules);var n=callableModuleNames.length;var callableModuleNameList=callableModuleNames.join(', ');invariant(false,\"Failed to call into JavaScript module method \"+module+\".\"+method+\"(). Module has not been registered as callable. Registered callable JavaScript modules (n = \"+n+\"): \"+callableModuleNameList+\".\\n        A frequent cause of the error is that the application entry file path is incorrect. This can also happen when the JS bundle is corrupt or there is an early initialization error when loading React Native.\");}if(!moduleMethods[method]){invariant(false,\"Failed to call into JavaScript module method \"+module+\".\"+method+\"(). Module exists, but the method is undefined.\");}moduleMethods[method].apply(moduleMethods,args);Systrace.endEvent();}},{key:\"__invokeCallback\",value:function __invokeCallback(cbID,args){this._lastFlush=Date.now();this._eventLoopStartTime=this._lastFlush;var callID=cbID>>>1;var isSuccess=cbID&1;var callback=isSuccess?this._successCallbacks.get(callID):this._failureCallbacks.get(callID);if(__DEV__){var debug=this._debugInfo[callID];var _module=debug&&this._remoteModuleTable[debug[0]];var method=debug&&this._remoteMethodTable[debug[0]][debug[1]];invariant(callback,\"No callback found with cbID \"+cbID+\" and callID \"+callID+\" for \"+(method?\" \"+_module+\".\"+method+\" - most likely the callback was already invoked\":\"module \"+(_module||'<unknown>'))+(\". Args: '\"+stringifySafe(args)+\"'\"));var profileName=debug?'<callback for '+_module+'.'+method+'>':cbID;if(callback&&this.__spy){this.__spy({type:TO_JS,module:null,method:profileName,args:args});}Systrace.beginEvent(\"MessageQueue.invokeCallback(\"+profileName+\", \"+stringifySafe(args)+\")\");}if(!callback){return;}this._successCallbacks.delete(callID);this._failureCallbacks.delete(callID);callback.apply(void 0,_toConsumableArray(args));if(__DEV__){Systrace.endEvent();}}}],[{key:\"spy\",value:function spy(spyOrToggle){if(spyOrToggle===true){MessageQueue.prototype.__spy=function(info){console.log((info.type===TO_JS?'N->JS':'JS->N')+\" : \"+(\"\"+(info.module!=null?info.module+'.':'')+info.method)+(\"(\"+JSON.stringify(info.args)+\")\"));};}else if(spyOrToggle===false){MessageQueue.prototype.__spy=null;}else{MessageQueue.prototype.__spy=spyOrToggle;}}}]);return MessageQueue;}();module.exports=MessageQueue;","map":{"version":3,"sources":["/Users/uheron/IH/RNStorybook/node_modules/react-native/Libraries/BatchedBridge/MessageQueue.js"],"names":["Systrace","require","deepFreezeAndThrowOnMutationInDev","stringifySafe","default","warnOnce","ErrorUtils","invariant","TO_JS","TO_NATIVE","MODULE_IDS","METHOD_IDS","PARAMS","MIN_TIME_BETWEEN_FLUSHES_MS","TRACE_TAG_REACT_APPS","DEBUG_INFO_LIMIT","MessageQueue","_lazyCallableModules","_queue","_successCallbacks","Map","_failureCallbacks","_callID","_lastFlush","_eventLoopStartTime","Date","now","_reactNativeMicrotasksCallback","__DEV__","_debugInfo","_remoteModuleTable","_remoteMethodTable","callFunctionReturnFlushedQueue","bind","flushedQueue","invokeCallbackAndReturnFlushedQueue","module","method","args","__guard","__callFunction","cbID","__invokeCallback","__callReactNativeMicrotasks","queue","length","name","factory","getValue","moduleID","methodID","params","onFail","onSucc","global","nativeCallSyncHook","processCallbacks","size","info","forEach","_","callID","debug","push","set","nativeTraceBeginAsyncFlow","isValidArgument","val","isFinite","Array","isArray","every","k","replacer","key","t","toString","JSON","stringify","nativeFlushQueueImmediate","counterEvent","__spy","type","methods","fn","__shouldPauseOnThrow","error","reportFatalError","DebuggerInternal","shouldPauseOnThrow","beginEvent","endEvent","moduleMethods","getCallableModule","callableModuleNames","Object","keys","n","callableModuleNameList","join","apply","isSuccess","callback","get","profileName","delete","spyOrToggle","prototype","console","log","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n * @format\n */\n\n'use strict';\n\nconst Systrace = require('../Performance/Systrace');\nconst deepFreezeAndThrowOnMutationInDev = require('../Utilities/deepFreezeAndThrowOnMutationInDev');\nconst stringifySafe = require('../Utilities/stringifySafe').default;\nconst warnOnce = require('../Utilities/warnOnce');\nconst ErrorUtils = require('../vendor/core/ErrorUtils');\nconst invariant = require('invariant');\n\nexport type SpyData = {\n  type: number,\n  module: ?string,\n  method: string | number,\n  args: mixed[],\n  ...\n};\n\nconst TO_JS = 0;\nconst TO_NATIVE = 1;\n\nconst MODULE_IDS = 0;\nconst METHOD_IDS = 1;\nconst PARAMS = 2;\nconst MIN_TIME_BETWEEN_FLUSHES_MS = 5;\n\n// eslint-disable-next-line no-bitwise\nconst TRACE_TAG_REACT_APPS = 1 << 17;\n\nconst DEBUG_INFO_LIMIT = 32;\n\nclass MessageQueue {\n  _lazyCallableModules: {[key: string]: (void) => {...}, ...};\n  _queue: [number[], number[], mixed[], number];\n  _successCallbacks: Map<number, ?(...mixed[]) => void>;\n  _failureCallbacks: Map<number, ?(...mixed[]) => void>;\n  _callID: number;\n  _lastFlush: number;\n  _eventLoopStartTime: number;\n  _reactNativeMicrotasksCallback: ?() => void;\n\n  _debugInfo: {[number]: [number, number], ...};\n  _remoteModuleTable: {[number]: string, ...};\n  _remoteMethodTable: {[number]: $ReadOnlyArray<string>, ...};\n\n  __spy: ?(data: SpyData) => void;\n\n  constructor() {\n    this._lazyCallableModules = {};\n    this._queue = [[], [], [], 0];\n    this._successCallbacks = new Map();\n    this._failureCallbacks = new Map();\n    this._callID = 0;\n    this._lastFlush = 0;\n    this._eventLoopStartTime = Date.now();\n    this._reactNativeMicrotasksCallback = null;\n\n    if (__DEV__) {\n      this._debugInfo = {};\n      this._remoteModuleTable = {};\n      this._remoteMethodTable = {};\n    }\n\n    // $FlowFixMe[cannot-write]\n    this.callFunctionReturnFlushedQueue =\n      // $FlowFixMe[method-unbinding] added when improving typing for this parameters\n      this.callFunctionReturnFlushedQueue.bind(this);\n    // $FlowFixMe[cannot-write]\n    // $FlowFixMe[method-unbinding] added when improving typing for this parameters\n    this.flushedQueue = this.flushedQueue.bind(this);\n\n    // $FlowFixMe[cannot-write]\n    this.invokeCallbackAndReturnFlushedQueue =\n      // $FlowFixMe[method-unbinding] added when improving typing for this parameters\n      this.invokeCallbackAndReturnFlushedQueue.bind(this);\n  }\n\n  /**\n   * Public APIs\n   */\n\n  static spy(spyOrToggle: boolean | ((data: SpyData) => void)) {\n    if (spyOrToggle === true) {\n      MessageQueue.prototype.__spy = info => {\n        console.log(\n          `${info.type === TO_JS ? 'N->JS' : 'JS->N'} : ` +\n            `${info.module != null ? info.module + '.' : ''}${info.method}` +\n            `(${JSON.stringify(info.args)})`,\n        );\n      };\n    } else if (spyOrToggle === false) {\n      MessageQueue.prototype.__spy = null;\n    } else {\n      MessageQueue.prototype.__spy = spyOrToggle;\n    }\n  }\n\n  callFunctionReturnFlushedQueue(\n    module: string,\n    method: string,\n    args: mixed[],\n  ): null | [Array<number>, Array<number>, Array<mixed>, number] {\n    this.__guard(() => {\n      this.__callFunction(module, method, args);\n    });\n\n    return this.flushedQueue();\n  }\n\n  invokeCallbackAndReturnFlushedQueue(\n    cbID: number,\n    args: mixed[],\n  ): null | [Array<number>, Array<number>, Array<mixed>, number] {\n    this.__guard(() => {\n      this.__invokeCallback(cbID, args);\n    });\n\n    return this.flushedQueue();\n  }\n\n  flushedQueue(): null | [Array<number>, Array<number>, Array<mixed>, number] {\n    this.__guard(() => {\n      this.__callReactNativeMicrotasks();\n    });\n\n    const queue = this._queue;\n    this._queue = [[], [], [], this._callID];\n    return queue[0].length ? queue : null;\n  }\n\n  getEventLoopRunningTime(): number {\n    return Date.now() - this._eventLoopStartTime;\n  }\n\n  registerCallableModule(name: string, module: {...}) {\n    this._lazyCallableModules[name] = () => module;\n  }\n\n  registerLazyCallableModule(name: string, factory: void => interface {}) {\n    let module: interface {};\n    let getValue: ?(void) => interface {} = factory;\n    this._lazyCallableModules[name] = () => {\n      if (getValue) {\n        module = getValue();\n        getValue = null;\n      }\n      /* $FlowFixMe[class-object-subtyping] added when improving typing for\n       * this parameters */\n      return module;\n    };\n  }\n\n  getCallableModule(name: string): {...} | null {\n    const getValue = this._lazyCallableModules[name];\n    return getValue ? getValue() : null;\n  }\n\n  callNativeSyncHook(\n    moduleID: number,\n    methodID: number,\n    params: mixed[],\n    onFail: ?(...mixed[]) => void,\n    onSucc: ?(...mixed[]) => void,\n  ): mixed {\n    if (__DEV__) {\n      invariant(\n        global.nativeCallSyncHook,\n        'Calling synchronous methods on native ' +\n          'modules is not supported in Chrome.\\n\\n Consider providing alternative ' +\n          'methods to expose this method in debug mode, e.g. by exposing constants ' +\n          'ahead-of-time.',\n      );\n    }\n    this.processCallbacks(moduleID, methodID, params, onFail, onSucc);\n    return global.nativeCallSyncHook(moduleID, methodID, params);\n  }\n\n  processCallbacks(\n    moduleID: number,\n    methodID: number,\n    params: mixed[],\n    onFail: ?(...mixed[]) => void,\n    onSucc: ?(...mixed[]) => void,\n  ): void {\n    if (onFail || onSucc) {\n      if (__DEV__) {\n        this._debugInfo[this._callID] = [moduleID, methodID];\n        if (this._callID > DEBUG_INFO_LIMIT) {\n          delete this._debugInfo[this._callID - DEBUG_INFO_LIMIT];\n        }\n        if (this._successCallbacks.size > 500) {\n          const info: {[number]: {method: string, module: string}} = {};\n          this._successCallbacks.forEach((_, callID) => {\n            const debug = this._debugInfo[callID];\n            const module = debug && this._remoteModuleTable[debug[0]];\n            const method = debug && this._remoteMethodTable[debug[0]][debug[1]];\n            info[callID] = {module, method};\n          });\n          warnOnce(\n            'excessive-number-of-pending-callbacks',\n            `Please report: Excessive number of pending callbacks: ${\n              this._successCallbacks.size\n            }. Some pending callbacks that might have leaked by never being called from native code: ${stringifySafe(\n              info,\n            )}`,\n          );\n        }\n      }\n      // Encode callIDs into pairs of callback identifiers by shifting left and using the rightmost bit\n      // to indicate fail (0) or success (1)\n      // eslint-disable-next-line no-bitwise\n      onFail && params.push(this._callID << 1);\n      // eslint-disable-next-line no-bitwise\n      onSucc && params.push((this._callID << 1) | 1);\n      this._successCallbacks.set(this._callID, onSucc);\n      this._failureCallbacks.set(this._callID, onFail);\n    }\n    if (__DEV__) {\n      global.nativeTraceBeginAsyncFlow &&\n        global.nativeTraceBeginAsyncFlow(\n          TRACE_TAG_REACT_APPS,\n          'native',\n          this._callID,\n        );\n    }\n    this._callID++;\n  }\n\n  enqueueNativeCall(\n    moduleID: number,\n    methodID: number,\n    params: mixed[],\n    onFail: ?(...mixed[]) => void,\n    onSucc: ?(...mixed[]) => void,\n  ) {\n    this.processCallbacks(moduleID, methodID, params, onFail, onSucc);\n\n    this._queue[MODULE_IDS].push(moduleID);\n    this._queue[METHOD_IDS].push(methodID);\n\n    if (__DEV__) {\n      // Validate that parameters passed over the bridge are\n      // folly-convertible.  As a special case, if a prop value is a\n      // function it is permitted here, and special-cased in the\n      // conversion.\n      const isValidArgument = (val: mixed) => {\n        switch (typeof val) {\n          case 'undefined':\n          case 'boolean':\n          case 'string':\n            return true;\n          case 'number':\n            return isFinite(val);\n          case 'object':\n            if (val == null) {\n              return true;\n            }\n\n            if (Array.isArray(val)) {\n              return val.every(isValidArgument);\n            }\n\n            for (const k in val) {\n              if (typeof val[k] !== 'function' && !isValidArgument(val[k])) {\n                return false;\n              }\n            }\n\n            return true;\n          case 'function':\n            return false;\n          default:\n            return false;\n        }\n      };\n\n      // Replacement allows normally non-JSON-convertible values to be\n      // seen.  There is ambiguity with string values, but in context,\n      // it should at least be a strong hint.\n      const replacer = (key: string, val: $FlowFixMe) => {\n        const t = typeof val;\n        if (t === 'function') {\n          return '<<Function ' + val.name + '>>';\n        } else if (t === 'number' && !isFinite(val)) {\n          return '<<' + val.toString() + '>>';\n        } else {\n          return val;\n        }\n      };\n\n      // Note that JSON.stringify\n      invariant(\n        isValidArgument(params),\n        '%s is not usable as a native method argument',\n        JSON.stringify(params, replacer),\n      );\n\n      // The params object should not be mutated after being queued\n      deepFreezeAndThrowOnMutationInDev(params);\n    }\n    this._queue[PARAMS].push(params);\n\n    const now = Date.now();\n    if (\n      global.nativeFlushQueueImmediate &&\n      now - this._lastFlush >= MIN_TIME_BETWEEN_FLUSHES_MS\n    ) {\n      const queue = this._queue;\n      this._queue = [[], [], [], this._callID];\n      this._lastFlush = now;\n      global.nativeFlushQueueImmediate(queue);\n    }\n    Systrace.counterEvent('pending_js_to_native_queue', this._queue[0].length);\n    if (__DEV__ && this.__spy && isFinite(moduleID)) {\n      this.__spy({\n        type: TO_NATIVE,\n        module: this._remoteModuleTable[moduleID],\n        method: this._remoteMethodTable[moduleID][methodID],\n        args: params,\n      });\n    } else if (this.__spy) {\n      this.__spy({\n        type: TO_NATIVE,\n        module: moduleID + '',\n        method: methodID,\n        args: params,\n      });\n    }\n  }\n\n  createDebugLookup(\n    moduleID: number,\n    name: string,\n    methods: ?$ReadOnlyArray<string>,\n  ) {\n    if (__DEV__) {\n      this._remoteModuleTable[moduleID] = name;\n      this._remoteMethodTable[moduleID] = methods || [];\n    }\n  }\n\n  // For JSTimers to register its callback. Otherwise a circular dependency\n  // between modules is introduced. Note that only one callback may be\n  // registered at a time.\n  setReactNativeMicrotasksCallback(fn: () => void) {\n    this._reactNativeMicrotasksCallback = fn;\n  }\n\n  /**\n   * Private methods\n   */\n\n  __guard(fn: () => void) {\n    if (this.__shouldPauseOnThrow()) {\n      fn();\n    } else {\n      try {\n        fn();\n      } catch (error) {\n        ErrorUtils.reportFatalError(error);\n      }\n    }\n  }\n\n  // MessageQueue installs a global handler to catch all exceptions where JS users can register their own behavior\n  // This handler makes all exceptions to be propagated from inside MessageQueue rather than by the VM at their origin\n  // This makes stacktraces to be placed at MessageQueue rather than at where they were launched\n  // The parameter DebuggerInternal.shouldPauseOnThrow is used to check before catching all exceptions and\n  // can be configured by the VM or any Inspector\n  __shouldPauseOnThrow(): boolean {\n    return (\n      // $FlowFixMe[cannot-resolve-name]\n      typeof DebuggerInternal !== 'undefined' &&\n      DebuggerInternal.shouldPauseOnThrow === true // eslint-disable-line no-undef\n    );\n  }\n\n  __callReactNativeMicrotasks() {\n    Systrace.beginEvent('JSTimers.callReactNativeMicrotasks()');\n    if (this._reactNativeMicrotasksCallback != null) {\n      this._reactNativeMicrotasksCallback();\n    }\n    Systrace.endEvent();\n  }\n\n  __callFunction(module: string, method: string, args: mixed[]): void {\n    this._lastFlush = Date.now();\n    this._eventLoopStartTime = this._lastFlush;\n    if (__DEV__ || this.__spy) {\n      Systrace.beginEvent(`${module}.${method}(${stringifySafe(args)})`);\n    } else {\n      Systrace.beginEvent(`${module}.${method}(...)`);\n    }\n    if (this.__spy) {\n      this.__spy({type: TO_JS, module, method, args});\n    }\n    const moduleMethods = this.getCallableModule(module);\n    if (!moduleMethods) {\n      const callableModuleNames = Object.keys(this._lazyCallableModules);\n      const n = callableModuleNames.length;\n      const callableModuleNameList = callableModuleNames.join(', ');\n      invariant(\n        false,\n        `Failed to call into JavaScript module method ${module}.${method}(). Module has not been registered as callable. Registered callable JavaScript modules (n = ${n}): ${callableModuleNameList}.\n        A frequent cause of the error is that the application entry file path is incorrect. This can also happen when the JS bundle is corrupt or there is an early initialization error when loading React Native.`,\n      );\n    }\n    if (!moduleMethods[method]) {\n      invariant(\n        false,\n        `Failed to call into JavaScript module method ${module}.${method}(). Module exists, but the method is undefined.`,\n      );\n    }\n    moduleMethods[method].apply(moduleMethods, args);\n    Systrace.endEvent();\n  }\n\n  __invokeCallback(cbID: number, args: mixed[]) {\n    this._lastFlush = Date.now();\n    this._eventLoopStartTime = this._lastFlush;\n\n    // The rightmost bit of cbID indicates fail (0) or success (1), the other bits are the callID shifted left.\n    // eslint-disable-next-line no-bitwise\n    const callID = cbID >>> 1;\n    // eslint-disable-next-line no-bitwise\n    const isSuccess = cbID & 1;\n    const callback = isSuccess\n      ? this._successCallbacks.get(callID)\n      : this._failureCallbacks.get(callID);\n\n    if (__DEV__) {\n      const debug = this._debugInfo[callID];\n      const module = debug && this._remoteModuleTable[debug[0]];\n      const method = debug && this._remoteMethodTable[debug[0]][debug[1]];\n      invariant(\n        callback,\n        `No callback found with cbID ${cbID} and callID ${callID} for ` +\n          (method\n            ? ` ${module}.${method} - most likely the callback was already invoked`\n            : `module ${module || '<unknown>'}`) +\n          `. Args: '${stringifySafe(args)}'`,\n      );\n      const profileName = debug\n        ? '<callback for ' + module + '.' + method + '>'\n        : cbID;\n      if (callback && this.__spy) {\n        this.__spy({type: TO_JS, module: null, method: profileName, args});\n      }\n      Systrace.beginEvent(\n        `MessageQueue.invokeCallback(${profileName}, ${stringifySafe(args)})`,\n      );\n    }\n\n    if (!callback) {\n      return;\n    }\n\n    this._successCallbacks.delete(callID);\n    this._failureCallbacks.delete(callID);\n    callback(...args);\n\n    if (__DEV__) {\n      Systrace.endEvent();\n    }\n  }\n}\n\nmodule.exports = MessageQueue;\n"]},"metadata":{},"sourceType":"script"}